<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>음식 검색</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; height:100vh; display:flex; flex-direction:column; }
    h1 { text-align:center; margin:16px 0; }
    .container { display:flex; flex:1; }
    #left-panel { width:60%; padding:20px; background:#fff; box-sizing:border-box; border-right:2px solid #ddd; overflow:auto; }
    #right-panel { width:40%; padding:20px; box-sizing:border-box; overflow:auto; }
    #food-info { background:#fff; border:1px solid #ddd; border-radius:6px; padding:16px; white-space:pre-wrap; min-height:160px; }
    #food-buttons { display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button { background:#007bff; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
    #total-energy { margin-top:12px; padding:8px; width:160px; text-align:right; }
    #search-container { display:flex; gap:8px; }
    #search-input { flex:1; padding:8px; }
  </style>
</head>
<body>
  <h1>음식 검색</h1>
  <div class="container">
    <div id="left-panel">
      <div id="food-info">음식 정보가 여기에 표시됩니다.</div>
    </div>
    <div id="right-panel">
      <div id="search-container">
        <input type="text" id="search-input" placeholder="음식을 검색하세요..." />
        <button id="search-btn" type="button">검색</button>
      </div>
      <div id="food-buttons"></div>
      <input type="text" id="total-energy" value="0 kcal" readonly />
    </div>
  </div>

  <script>
    function apiUrl(path, params = {}) {
      const url = new URL(path, window.location.origin);
      Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));
      return url.toString();
    }

    async function getFoodInfo(foodName) {
      try {
        const res = await fetch(apiUrl('/get_food_info', { food_name: foodName }));
        if (!res.ok) throw new Error('status ' + res.status);
        const data = await res.json();
        if (data.error) return alert(data.error);
        const val = (x) => (x === 0 || x ? x : '정보 없음');
        document.getElementById('food-info').innerText =
`식품명: ${val(data['식품명'])}
대분류명: ${val(data['식품대분류명'])}
에너지: ${val(data['에너지(kcal)'])} kcal
수분: ${val(data['수분(g)'])} g
단백질: ${val(data['단백질(g)'])} g
지방: ${val(data['지방(g)'])} g
탄수화물: ${val(data['탄수화물(g)'])} g
당류: ${val(data['당류(g)'])} g
칼슘: ${val(data['칼슘(mg)'])} mg
나트륨: ${val(data['나트륨(mg)'])} mg
콜레스테롤: ${val(data['콜레스테롤(mg)'])} mg
포화지방산: ${val(data['포화지방산(g)'])} g`;
      } catch (e) {
        console.error(e);
        alert('문제가 발생했습니다. (getFoodInfo)');
      }
    }

    async function searchFoods() {
      try {
        const query = document.getElementById('search-input').value || '';
        const res = await fetch(apiUrl('/search_foods', { query }));
        if (!res.ok) throw new Error('status ' + res.status);
        const data = await res.json();

        const wrap = document.getElementById('food-buttons');
        wrap.innerHTML = '';
        if (Array.isArray(data.food_names) && data.food_names.length) {
          data.food_names.forEach((name) => {
            const infoBtn = document.createElement('button');
            infoBtn.textContent = name;
            infoBtn.onclick = () => getFoodInfo(name);
            wrap.appendChild(infoBtn);
          });
        } else {
          const p = document.createElement('p');
          p.textContent = '검색 결과가 없습니다.';
          wrap.appendChild(p);
        }
      } catch (e) {
        console.error(e);
        alert('문제가 발생했습니다. (searchFoods)');
      }
    }

    document.getElementById('search-btn').addEventListener('click', searchFoods);
    document.getElementById('search-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') searchFoods();
    });
  </script>
</body>
</html>
